<div class="view-container">
  <div class="greeting">
    <h2>Dashboard</h2>
  </div>
  <div class="dashboard-content" *ngIf="selectedJourney; else elseContent">
    <div class="dashboard-header">
      <h3>Hi there, {{ name }}!</h3>
      <div class="spacer"></div>
      <div>
        <mat-form-field color="accent">
          <mat-select color="accent" [(ngModel)]="selectedJourney" name="journeySelection"
            (selectionChange)="selectYear(selectedJourney.years[0])" title="select an active journeys">
            <mat-select-trigger>{{selectedJourney.value.title}}</mat-select-trigger>
            <mat-option *ngFor="let journey of dropdownContent" [value]="journey">
              {{journey.viewValue}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="journey-details">

        <div class="dashboard-component">
          <div class="data-container-title spanning-content">
            <h4 style="font-weight: 500;">Recent Stats</h4>
            <div class="spacer"></div>
            <p>past <b style="cursor: pointer; color: var(--accent);" (click)="toggleLineChartMode()">{{lineChartMode}}</b></p>
            <mat-icon title="save info">save_alt</mat-icon>
          </div> 
          <div class="stats-container">
            <div class="stat-item">
              <div class="stat-item-content">
                <p class="stat-item-primary-text">
                  {{ selectedJourney.frequencyAxes[lineChartMode].y | arrayFilter:'count' }}
                </p>
                <p class="stat-item-secondary-text">applications</p>
              </div>
              <p style="color: var(--titles-secondary);">submitted in the past {{lineChartMode}}</p>
            </div>

            <div class="stat-item">
              <div class="stat-item-content">
                <p class="stat-item-primary-text">
                  {{ selectedJourney.frequencyAxes[lineChartMode].y | arrayFilter:'average' }}
                </p>
                <p class="stat-item-secondary-text">/{{ lineChartMode === 'year' ? 'month' : 'day'}}</p>
              </div>
              <p style="color: var(--titles-secondary);">average application frequency</p>
            </div>
            <!-- <p>Start Date: {{selectedJourney.value.startDate | date }}</p>
            <p>Applications submitted: {{selectedJourney.value.applications.length}}</p>
            <p>Application frequency: {{selectedJourney.frequency}} / day</p> -->
          </div>
          <line-chart-wrapper *ngIf="(selectedJourney.frequencyAxes[lineChartMode].y | arrayFilter) > 0; else noChart" style="width: 100%; height: 40%; display: block; margin: 0 auto;"
            [data]="selectedJourney.frequencyData[lineChartMode]"
            [curve]="'monotoneX'"
            [xScale]="{
              type: 'point'
            }"
            [yScale]="{
              type: 'linear'
            }"
            [tooltipFormat]="setCustomTooltip()"
            [axisBottom]="{
              tickValues: selectedJourney.frequencyAxes[lineChartMode].x
            }"
            [axisLeft]="{
              tickValues: (selectedJourney.frequencyAxes[lineChartMode].y | arrayFormatter:['fill', 'reduce'])
            }"
            [isInteractive]="true"
            [margin]="{ top: 10, bottom: 40, right: 40, left: 40 }"
            [enableGridX]="false" [enableGridY]="false" [colors]="pieChartPalette.slice(0, 1)" [pointSize]="8" [pointColor]="theme.background"
            [pointBorderColor]="pieChartPalette[0]" [pointBorderWidth]="2"
            [theme]="{
              axis: {
                textColor: theme.textColor
              },
              textColor: theme.textColor,
              markers: {
                textColor: theme.textColor
              }
            }"
            [motionDamping]="30">
          </line-chart-wrapper>
          <ng-template #noChart>
            <div>Nope. No Chart.</div>
          </ng-template>
        </div>

        <div class="dashboard-component">
          <div class="data-container-title spanning-content">
            <h4>
              Status Breakdown
            </h4>
            <div class="spacer"></div>
            <mat-icon title="save info">save_alt</mat-icon>
          </div>
          
          <div *ngIf="!isEmpty(selectedJourney.statusData); else statusPlaceholder;" class="status-container" style="width: 90%; height: 80%; margin: 0 auto;" #statusContainer>
            <pie-chart-wrapper [data]="selectedJourney.statusData"
              [width]="800" [height]="800"
              [margin]="{ top: 0, right: 60, bottom: 0, left: 10 }" [pixelRatio]="2" [innerRadius]="0.3"
              [padAngle]="0.7" [cornerRadius]="3" [colors]="pieChartPalette" [enableRadialLabels]="false"
              [borderColor]="{ from: 'color', modifiers: [ [ 'darker', 0.6 ] ] }" [radialLabelsSkipAngle]="10"
              [radialLabelsTextXOffset]="6" [radialLabelsTextColor]="theme.textColor" [radialLabelsLinkOffset]="0"
              [radialLabelsLinkDiagonalLength]="10" [radialLabelsLinkHorizontalLength]="20" [sliceLabel]="'percentage'"
              [radialLabelsLinkStrokeWidth]="1" [radialLabelsLinkColor]="{ from: 'color' }" [slicesLabelsSkipAngle]="10"
              [slicesLabelsTextColor]="'#fff'" [animate]="true" [motionStiffness]="90" [motionDamping]="15" [legends]="[
                {
                    anchor: 'bottom-right',
                    direction: 'column',
                    translateX: 80,
                    itemWidth: 120,
                    itemHeight: 14,
                    itemsSpacing: 2,
                    symbolSize: 14,
                    symbolShape: 'circle',
                    textColor: theme.textColor,
                    itemTextColor: theme.textColor
                }
            ]" style="position: relative;">
            </pie-chart-wrapper>
          </div>
          <ng-template #statusPlaceholder>
            <div class="status-container" style="height: 85%;">
              <p>The status breakdown of added applications will appear here.</p>
            </div>
          </ng-template>
            
        </div>
        
        <div class="dashboard-component" style="width: 100%;">
          <div class="data-container-title spanning-content">
            <h4>
              Productivity Calendar
            </h4>
            <div class="spacer"></div>
            <mat-icon title="save info">save_alt</mat-icon>
          </div>
          <div class="calendar-container" style="width: 90%; height: 50%; margin: 0 auto;">
            <calendar-wrapper [data]="selectedJourney.calendarData" [from]="currentYear+'-02-01'"
              [to]="currentYear+'-11-01'" [emptyColor]="theme.emptyColor"
              [margin]="{ top: 0, right: 0, bottom: 0, left: 0 }"
              [colors]="calendarPalette" [yearSpacing]="40" [direction]="(resizeService.mobileSize$ | async) ? 'horizontal' : 'horizontal'"
              [monthBorderColor]="theme.transparent" [dayBorderWidth]="3" [dayBorderColor]="theme.background"
              [legends]="[
                {
                  anchor: 'bottom-right',
                  direction: 'row',
                  translateY: 10,
                  itemCount: 4,
                  itemWidth: 42,
                  itemHeight: 36,
                  itemsSpacing: 14,
                  itemDirection: 'left-to-right',
                  textColor: theme.textColor,
                  itemTextColor: theme.textColor
                }]"
              [theme]="{
                axis: {
                  textColor: theme.textColor
                },
                textColor: theme.textColor,
                markers: {
                  textColor: theme.textColor
                }
              }"
              [minValue]="'auto'">
            </calendar-wrapper>
          </div>
          <ul style="list-style: none;" class="year-selector">
            <li *ngFor="let year of selectedJourney.years" (click)="selectYear(year)"
              [style.background-color]="year == currentYear ? 'var(--titles-secondary)' : 'transparent'">
              <p [style.color]="year == currentYear ? 'var(--bg)' : 'var(--text)'">{{year}}</p>
            </li>
          </ul>
        </div>

        <div class="dashboard-component" style="width: 100%; height: 420px;">
          <div class="data-container-title spanning-content">
            <h4>Applications</h4>
            <div class="spacer"></div>
            <mat-form-field style="padding: 0; width: 120px;">
              <mat-select color="accent" name="statusSelection" [(ngModel)]="selectedStatus" title="application status filter">
                <mat-option *ngFor="let status of statuses" [value]="status">
                  {{status.viewValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="app-list-container" style="height: 78%;">
            <mat-list *ngIf="selectedJourney.value.applications.length > 0; else applicationsPlaceholder" style="height: 100%; overflow-y: scroll;" class="app-list-item">
              <mat-list-item class="clickable-item" *ngFor="let app of (selectedJourney.value.applications | appFilter:[{ property: 'status', value: selectedStatus.value }] );"
                (click)="selectApplication(app)">
                <!-- Web default list-item -->
                <mat-icon *ngIf="!(resizeService.tabletSize$ | async)" matListIcon>folder</mat-icon>
                <div *ngIf="!(resizeService.tabletSize$ | async); else mobileListItem" class="app-list-item" matLine>
                  <div class="spanning-content" >
                    <h4 style="text-align: left; color: var(--text);">{{app.positionTitle + '  '}}</h4>
                    <span style="padding-left: 10px; color: var(--titles-secondary);"> @ {{app.companyName}}</span>
                    <div class="spacer"></div>
                    <span>Date Applied: {{ app.appDate | date }}</span>
                  </div>
                </div>
                <!-- Mobile view list-item -->
                <ng-template #mobileListItem>
                  <div class="app-list-item" matLine>
                    <div class="spanning-content">
                      <h4 style="text-align: left; color: var(--text);">{{app.positionTitle + '  '}}</h4>
                    </div>
                  </div>
                  <div class="app-list-item" matLine>
                    <div class="spanning-content">
                      <span style="color: var(--titles-secondary);"> @ {{app.companyName}}</span>
                      <div class="spacer"></div>
                      <span>Applied: {{ app.appDate | date }}</span>
                    </div>
                  </div>
                </ng-template>
                
                
              </mat-list-item>
            </mat-list>
            <ng-template #applicationsPlaceholder>
              <div>
                <p>Added applications will appear here.</p>
              </div>
            </ng-template>
          </div>
            
        </div>

    </div>

  </div>

  <ng-template class="dashboard-content" #elseContent>
    <div class="placeholder-text">
      <h4>Start adding journeys to track them here!</h4>
      <button class="add-btn" title="Add journey">
        <p *ngIf="!(resizeService.mobileSize$ | async)">Add</p>
        <mat-icon [inline]="true" aria-hidden="false" aria-label="Add journey icon">add</mat-icon>
      </button>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 676 322.5"
        style="margin-top: 30px; filter: grayscale(100%);">
        <defs>
          <style>
            .cls-1 {
              fill: none;
              stroke: #7e786b;
              stroke-linecap: round;
              stroke-miterlimit: 10;
              stroke-width: 89px;
            }

            .cls-2 {
              fill: #717a6c;
            }

            .cls-3 {
              fill: #98a88e;
            }

            .cls-4 {
              fill: #b3c7a5;
            }

          </style>
        </defs>
        <title>no journeys added</title>
        <g id="Layer_2" data-name="Layer 2">
          <g id="Layer_1-2" data-name="Layer 1">
            <line class="cls-1" x1="44.5" y1="232.7" x2="489.38" y2="232.7" />
            <line class="cls-1" x1="217.51" y1="278" x2="631.5" y2="278" />
            <path class="cls-2"
              d="M159.5,107.93a6.08,6.08,0,0,0-5.68-4.67,5.79,5.79,0,0,0-4.85,2.8,7.47,7.47,0,0,0-.83,6c1.62,5.65,2.22,12.28-.12,14.34-1.33,1.17-3.92,1.45-6.25,1.62l-.28,0V105h0a5.83,5.83,0,0,0,0-.59,8.73,8.73,0,0,0-17.46,0c0,.2,0,.39,0,.59h0V149.3l-.41,0c-2.38-.17-5-.45-6.38-1.62-2.38-2.06-1.77-8.69-.12-14.34a7.36,7.36,0,0,0-.84-6,5.93,5.93,0,0,0-5-2.8,6.17,6.17,0,0,0-5.79,4.67,48.08,48.08,0,0,0-2,13.35c.07,8,3,12.58,5.4,15,3.76,3.8,8.7,4.72,12.08,5.09,1,.1,2,.18,3,.24v31c5.72.42,11.6-1.4,17.46-1.22v-51c1-.06,1.93-.14,2.87-.24,3.32-.37,8.15-1.29,11.84-5.09,2.38-2.45,5.23-7.05,5.3-15A49.05,49.05,0,0,0,159.5,107.93Z" />
            <path class="cls-3"
              d="M458.7,101.37a8.39,8.39,0,0,0-7.92-6.17A8.24,8.24,0,0,0,444,98.9a9.45,9.45,0,0,0-1.15,8c2.27,7.47,3.1,16.22-.16,18.94-1.86,1.55-5.48,1.92-8.73,2.14l-.39,0V97.52h0c0-.26,0-.51,0-.77,0-6.37-5.46-11.53-12.19-11.53s-12.2,5.16-12.2,11.53c0,.26,0,.51,0,.77h0V156l-.57,0c-3.32-.23-7-.6-8.91-2.15-3.32-2.71-2.48-11.47-.16-18.94a9.32,9.32,0,0,0-1.18-8,8.35,8.35,0,0,0-15,2.48A60.06,60.06,0,0,0,380.5,147c.1,10.53,4.16,16.6,7.54,19.84,5.26,5,12.15,6.24,16.87,6.72,1.39.14,2.82.25,4.26.33v40.88c8,.55,16.2-1.85,24.39-1.61V145.88c1.35-.08,2.69-.18,4-.31,4.63-.49,11.39-1.71,16.54-6.73,3.33-3.23,7.31-9.3,7.4-19.84A61,61,0,0,0,458.7,101.37Z" />
            <path class="cls-4"
              d="M312.94,34c-2.23-7.77-8.57-13-15.77-13a16.2,16.2,0,0,0-13.51,7.78,20.89,20.89,0,0,0-2.29,16.75c4.51,15.72,6.16,34.15-.32,39.87-3.7,3.25-10.91,4-17.38,4.51l-.77,0V25.88h-.08c0-.53.08-1.07.08-1.61a24.27,24.27,0,1,0-48.54,0c0,.54,0,1.08.09,1.61h-.09V149l-1.14-.06c-6.6-.48-13.95-1.26-17.72-4.51-6.61-5.72-4.93-24.15-.33-39.87a20.51,20.51,0,0,0-2.34-16.75A16.56,16.56,0,0,0,179.06,80c-7.35,0-13.81,5.22-16.08,13-2.65,9.07-5.79,22.87-5.67,37.1.19,22.17,8.26,34.95,15,41.76C182.78,182.41,196.48,185,205.89,186c2.77.29,5.6.52,8.47.68v86c15.91,1.16,32.25-3.89,48.54-3.38V127.66c2.69-.16,5.36-.38,8-.66,9.22-1,22.66-3.59,32.92-14.15,6.61-6.81,14.53-19.59,14.72-41.76C318.62,56.86,315.54,43.06,312.94,34Z" />
          </g>
        </g>
      </svg>
    </div>
  </ng-template>

</div>
